---
- hosts: all
  tasks:
  - name: update apt
    apt: update_cache=yes
    become: yes

  - name: install apt packages
    apt:
      name: "{{item.name}}"
      state: latest
    become: yes
    with_items:
    - {name: apt-transport-https}
    - {name: build-essential}
    - {name: ca-certificates}
    - {name: ctags}
    - {name: curl}
    - {name: direnv}
    - {name: fd-find}
    - {name: neovim}
    - {name: python3-pip}
    - {name: ripgrep}
    - {name: tig}

  - name: install snap packages
    snap:
      name: "{{item.name}}"
      classic: yes
      state: present
    become: yes
    with_items:
    - {name: go}
    - {name: jq}
    - {name: kubectl}
    - {name: kustomize}
    - {name: ruby}

  - name: Add Docker GPG apt Key
    become: yes
    apt_key:
     url: https://download.docker.com/linux/ubuntu/gpg
     state: present

  - name: Add Docker Repository
    become: yes
    apt_repository:
     repo: deb https://download.docker.com/linux/ubuntu bionic stable
     state: present

  - name: Update apt and install docker-ce
    become: yes
    apt: update_cache=yes name=docker-ce state=latest

  - name: Install kind
    get_url:
      url: https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64
      dest: /usr/local/bin/kind
      mode: '0755'
    become: yes

  - name: Install clusterctl
    get_url:
      url: https://github.com/kubernetes-sigs/cluster-api/releases/download/v0.3.16/clusterctl-linux-amd64
      dest: /usr/local/bin/clusterctl
      mode: '0755'
    become: yes

  - name: Install kubectx
    get_url:
      url: https://github.com/ahmetb/kubectx/releases/download/v0.9.3/kubectx
      dest: /usr/local/bin/kubectx
      mode: '0755'
    become: yes

  - name: Install kubens
    get_url:
      url: https://github.com/ahmetb/kubectx/releases/download/v0.9.3/kubens
      dest: /usr/local/bin/kubens
      mode: '0755'
    become: yes

  - name: install python support for nvim
    command: pip3 install --user --upgrade pynvim

  - name: install Luan's Neovim distribution
    git:
      repo: https://github.com/luan/nvim
      dest: ~/.config/nvim

  - name: get TPM
    git:
      repo: https://github.com/tmux-plugins/tpm
      dest: ~/.tmux/plugins/tpm

  - name: Install tmuxinator
    gem:
      name: tmuxinator
      state: latest

  - name: set up symlinks
    file:
      path: "{{item.target}}"
      src: "{{item.src}}"
      state: link
      force: yes
    with_items:
    - {target: ~/.bashrc, src: "{{ansible_env.PWD}}/config/bashrc"}
    - {target: ~/.bash_profile, src: "{{ansible_env.PWD}}/config/bash_profile"}
    - {target: ~/.gitconfig, src: "{{ansible_env.PWD}}/config/gitconfig"}
    - {target: ~/.git-authors, src: "{{ansible_env.PWD}}/config/git-authors"}
    - {target: ~/.config/nvim/user/before.vim, src: "{{ansible_env.PWD}}/config/nvim/before.vim"}
    - {target: ~/.config/nvim/user/plug.vim, src: "{{ansible_env.PWD}}/config/nvim/plug.vim"}
    - {target: ~/.config/nvim/user/after.vim, src: "{{ansible_env.PWD}}/config/nvim/after.vim"}
    - {target: ~/.tmux.conf, src: "{{ansible_env.PWD}}/config/tmux.conf"}

